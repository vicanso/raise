(function(){seajs.use(["jquery","underscore","Backbone","jtTouchEvent","jtLazyLoad","utils"],function(a,b,c,d,e,f){var g,h,i;return g=c.View.extend({events:{"click .categoryList .category":"showCategory","click .itemListView .loadMore":"loadMore"},initialize:function(c){return this.currentIndex=0,this.itemsList=c.itemsList,this.template=b.template(a(".itemTemplate",this.$el).html()),this.lazyLoadImage(0)},loadMore:function(c){var d,g,h,i;return i=a(c.currentTarget),i.hasClass("loading")||i.children().toggleClass("hidden"),d=this.currentIndex,g=this.itemsList[d],h=b.last(g.items),a.ajax({url:"/item/more/"+g.category+"/"+h._id+"/10",dataType:"json"}).success(function(a){return function(c){var h,j;return(null!=c?c.length:void 0)?(h=b.map(c,function(b){return a.template(b)}),j=a.getListView(d),j.find(".itemList").append(h.join("")),e.load(j.find(".item"),j),g.items=g.items.concat(c),g.total>g.items.length?i.children().toggleClass("hidden"):i.remove()):f.prompt("已经没有该分类的宝贝了哦！")}}(this)).error(function(){return f.alert("加载数据失败，请稍候再试!")})},getItemListHtml:function(a){var c;return c=b.map(this.itemsList[a].items,function(a){return function(b){return a.template(b)}}(this)),c.length||c.push("<li>该分类暂无相关宝贝哦！"),'<div class="itemListView" data-index="'+a+'"><ul class="itemList">'+c.join("")+"</ul></div>"},getListView:function(b){return a(".itemListView",this.$el).filter(function(){return b===window.parseInt(a(this).data("index"))})},showCategory:function(b){var c,d,e,f;f=a(b.currentTarget),f.hasClass("active")||(d=f.index(),f.siblings(".active").addBack().toggleClass("active"),c=this.getListView(this.currentIndex),e=this.getListView(d),e.length||(e=a(this.getItemListHtml(d)),e.appendTo(this.$el),this.lazyLoadImage(d)),c.addClass("hidden"),e.removeClass("hidden"),this.currentIndex=d)},lazyLoadImage:function(a){var b;return b=this.getListView(a),e.load(b.find(".item"),b)}}),new g({el:"#contentContainer .categorySelectContainer",itemsList:JT_GLOBAL.itemsList}),h=c.View.extend({events:{"focus .search":"focus","blur .search":"blur","keyup .search":"keyup"},initialize:function(){},focus:function(){var a,b;return a=this.$el.find(".search"),b=a.closest(".searchField"),b.css("margin-right",40),b.siblings(".clear").removeClass("hidden")},blur:function(){var a,b;a=this.$el.find(".search"),a.val(""),b=a.closest(".searchField"),b.siblings(".clear").addClass("hidden"),b.css("margin-right",0)},keyup:function(b){var c,d;return 13===b.keyCode?(d=this.$el.find(".search"),c=a.trim(d.val()),c&&this.search(c),d.blur()):void 0},search:function(b){this.searchXhr&&this.searchXhr.abort(),this.searchXhr=a.ajax({url:"/search/"+b,dataType:"json"}).success(function(a){(null!=a?a.total:void 0)?console.dir(a):f.alert("未找到满足条件的宝贝哦！"),this.searchXhr=null}).error(function(){this.searchXhr=null})}}),new h({el:"#contentContainer .searchContainer"}),i=function(){var b,c,d,e,g;return e=a("#contentContainer .searchContainer .search"),c=function(){var b,c;b=a(this),c=b.closest(".searchField"),c.css("margin-right",40),c.siblings(".clear").removeClass("hidden")},b=function(b,c){var d;return d=a('<li class="category"><a href="javascript:;">'+b+"</a></li>"),a("#contentContainer .categorySelectContainer .categoryList").append(d),JT_GLOBAL.itemsList.push(c),d.trigger("click")},g=null,d=function(c){g&&g.abort(),g=a.ajax({url:"/search/"+c,dataType:"json"}).success(function(a){(null!=a?a.total:void 0)?b(c,a):f.alert("未找到满足条件的宝贝哦！"),g=null}).error(function(){g=null})},e.focus(c).blur(function(){var b,c;b=a(this),b.val(""),c=b.closest(".searchField"),c.siblings(".clear").addClass("hidden"),c.css("margin-right",0)}),e.on("keyup",function(b){var c;return 13===b.keyCode?(c=a.trim(a(this).val()),c&&d(c),e.blur()):void 0})},"development"===CONFIG.env?seajs.emit("loadComplete"):void 0})}).call(this);